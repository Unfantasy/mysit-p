<!DOCTYPE html>
<html>

<head lang="en">
  <meta charset="UTF-8">
  <title>天气查询</title>
  <meta name="viewport" content="width=device-width,user-scalable=no" />
  <link rel="stylesheet" href="css/j-standard.css">
  <style>
    .content {
      padding: 15px;
      width: 500px;
      max-width: 100%;
      margin: 0 auto;
    }
    ul, li {
      list-style: none;
    }
    [type="button"] {
      margin-left: 10px;
      padding: 0 5px;
    }
  </style>

</head>

<body>
  <div class="content">
    请输入想要查询的城市：<input type="text" id="city" placeholder="如北京" /><input type="button" onclick="getWeather()" value="查询" />
    <br/><br/>
    <div class="result hidden">
      <ul>
        <li>省份： <span class="J_province"></span></li>
        <li>城市： <span class="J_city"></span></li>
        <li>天气： <span class="J_weather"></span></li>
        <li>实时气温： <span class="J_temperature"></span>°C</li>
        <li>风向： <span class="J_winddirection"></span></li>
        <li>风力： <span class="J_windpower"></span></li>
        <li>湿度： <span class="J_humidity"></span></li>
        <li>查询时间： <span class="J_reporttime"></span></li>
      </ul>
    </div>
  </div>
  <script src="js/jquery.min.js"></script>
  <script src="js/j-function.js"></script>
  <script>
    //高德API
    function getWeather() {
      var key = 'eacb757c664e60af0f465beba6bfd8cd';
      var city = $("#city").val();
      var url = 'http://restapi.amap.com/v3/config/district?key=' + key + '&showbiz=false&subdistrict=0&keywords=' + city;
      if (city == '') {
        alert('请输入城市名！');
        return;
      }
      $.ajax({
        url: url,
        type: 'get',
        dataType: 'jsonp',
        success: function(data) {
          if (data.status == '0') {
            console.log(JSON.stringify(data));
            alert('获取失败');
          } else {
            var adcode = data.districts[0].adcode
            var data = {
              city: adcode,
              key: key
            };
            $.ajax({
              url: 'http://restapi.amap.com/v3/weather/weatherInfo',
              type: 'get',
              data: data,
              dataType: 'jsonp',
              success: function(data) {
                //alert("success"+JSON.stringify(data));
                if (data.status == '0') {
                  console.log(JSON.stringify(data));
                  alert('获取失败');
                } else {
                  var weatherObj = data.lives[0];
                  $('.J_province').html(weatherObj.province);
                  $('.J_city').html(weatherObj.city);
                  $('.J_weather').html(weatherObj.weather);
                  $('.J_temperature').html(weatherObj.temperature);
                  $('.J_winddirection').html(weatherObj.winddirection);
                  $('.J_windpower').html(weatherObj.windpower);
                  $('.J_humidity').html(weatherObj.humidity);
                  $('.J_reporttime').html(new Date(weatherObj.reporttime).format('yyyy年MM月dd日 hh:mm:ss'));
                  $('.result').removeClass('hidden');
                  // console.log(JSON.stringify(data));
                }
              },
              error: function(e) {
                console.log(JSON.stringify(data));
                alert('AjaxFail: ' + JSON.stringify(e));
              }
            });
          }
        },
        error: function(e) {
          console.log(JSON.stringify(data));
          alert('AjaxFail: ' + JSON.stringify(e));
        }
      })

    }
  </script>
</body>

</html>
